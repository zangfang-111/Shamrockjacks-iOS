<ion-modal-view sb-page-background ng-controller="CustomerController" class="customer-view">

    <ion-header-bar class="bar-custom">
        <div class="buttons">
            <button class="button button-clear" ng-click="_pcustomer_close()">{{ "Close" | translate }}</button>
        </div>
        <h1 class="title" ng-click="_pcustomer_check_update();">{{ page_title | translate }}</h1>
        <div class="buttons" ng-show="is_logged_in">
            <button class="button button-clear ion-power" ng-click="_pcustomer_logout()">
            </button>
        </div>
    </ion-header-bar>

    <ion-content>

        <form method="post" name="loginForm" ng-submit="_pcustomer_login(customer)" class="slide-down" ng-show="display_login_form">

            <div class="list" ng-class="{'card': card_design}">

                <div class="item item-text-wrap item-icon-left item-custom" ng-click="_pcustomer_login_fb()" ng-if="!is_logged_in" ng-show="_facebook_enabled">
                    <i class="icon ion-social-facebook-outline"></i>
                    {{ "Log-in with Facebook" | translate }}
                </div>

                <div class="item item-divider item-divider-custom" ng-if="!is_logged_in" ng-show="_facebook_enabled">
                    <p>{{ "Or with your account" | translate }} :</p>
                </div>

                <label class="item item-input item-custom">
                    <i class="icon ion-ios-person"></i>
                    <input type="email" placeholder="{{ 'Email' | translate }}" ng-model="customer.email" />
                </label>

                <label class="item item-input item-custom">
                    <i class="icon ion-locked"></i>
                    <input type="password" placeholder="{{ 'Password' | translate }}" ng-model="customer.password" />
                </label>

            </div>

            <div ng-class="{'padding': card_design}">

                <button type="submit" class="button button-positive button-positive-custom" ng-class="{'button-block': card_design, 'button-full': !card_design}" ng-show="!is_loading">{{ "Log-in" | translate }}</button>

            </div>

            <div class="list" ng-class="{'card': card_design}">

                <div class="item item-custom item-icon-left" ng-click="displayForgotPasswordForm()">
                    <i class="icon ion-ios-help-empty"></i>
                    {{ "Forgot your password?" | translate }}
                </div>
                <div class="item item-custom item-icon-left" ng-click="displayAccountForm()">
                    <i class="icon ion-ios-plus-empty"></i>
                    {{ "Create an account" | translate }}
                </div>

                <div class="item item-custom item-icon-left" ng-click="displayPrivacyPolicy('login')">
                    <i class="icon ion-navicon"></i>
                    {{ "Privacy Policy" | translate }}
                </div>
            </div>

        </form>

        <form method="post" name="forgotPasswordForm" ng-submit="_pcustomer_forgotten_password(customer.email)" class="slide-top" ng-show="display_forgot_password_form">

            <div class="list" ng-class="{'card': card_design}">

                <div class="item item-text-wrap item-custom">
                    <p>
                        {{ "Please enter your email address." | translate }}
                        <br />
                        {{ "We'll send you your password right now." | translate }}
                    </p>
                </div>

                <label class="item item-input item-custom">
                    <i class="icon ion-ios-person"></i>
                    <input type="email" placeholder="{{ 'Email' | translate }}" ng-model="customer.email" />
                </label>

            </div>

            <div ng-class="{'padding': card_design}">
                <button type="submit"
                        class="button button-positive button-positive-custom"
                        ng-class="{'button-block': card_design, 'button-full': !card_design}"
                        ng-show="!is_loading">{{ "Send" | translate }}</button>
            </div>

            <div class="list" ng-class="{'card': card_design}">

                <div class="item item-custom item-icon-left" ng-click="displayLoginForm()">
                    <i class="icon ion-ios-person"></i>
                    {{ "Click here to log-in" | translate }}
                </div>

            </div>


        </form>

        <form method="post" name="accountForm" ng-submit="_pcustomer_register_or_save(customer)" class="slide-top" ng-show="display_account_form">
            <section class="avatar text-center padding" ng-if="show_avatar">
                <div>
                    <img width="150" height="150" ng-src="{{ avatar_url }}"
                         src="data:image/jpeg;base64,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"
                         class="padding stable-bg stable-border"
                         ng-click="editAvatar()" sb-load="avatarLoaded()" sb-error="hideAvatar()" />
                </div>
            </section>

            <div class="list" ng-class="{'card': card_design}">

                <div class="item item-input item-custom">
                    <div class="input-label">
                        {{ "Firstname" | translate }}
                    </div>
                    <input class="text-right" type="text" placeholder="{{ 'Firstname' | translate }}" ng-model="customer.firstname" />
                </div>

                <label class="item item-input item-custom">
                    <div class="input-label">
                        {{ "Lastname" | translate }}
                    </div>
                    <input class="text-right" type="text" placeholder="{{ 'Lastname' | translate }}" ng-model="customer.lastname" />
                </label>

                <label class="item item-input item-custom" ng-if="optional_fields.nickname">
                    <div class="input-label">
                        {{ "Nickname" | translate }}
                    </div>
                    <input class="text-right" type="text" placeholder="{{ 'Nickname' | translate }}" ng-model="customer.nickname" />
                </label>

                <label class="item item-input item-custom">
                    <div class="input-label">
                        {{ "Email" | translate }}
                    </div>
                    <input class="text-right" type="email" placeholder="{{ 'Email' | translate }}" ng-model="customer.email" />
                </label>

                <label class="item item-custom"
                       style="font-size: 14px;"
                       ng-click="customer.change_password = !customer.change_password"
                       ng-if="is_logged_in">
                    {{ 'Change Password' | translate }}
                </label>

                <label class="item item-input item-custom" ng-if="customer.change_password && is_logged_in">
                    <div class="input-label">
                        {{ "Old Password" | translate }}
                    </div>
                    <input class="text-right" type="password" placeholder="{{ 'Old Password' | translate }}" ng-disabled="!customer.change_password" ng-model="customer.old_password" />
                </label>
                <label class="item item-input item-custom" ng-if="customer.change_password || !is_logged_in">
                    <div class="input-label">
                        {{ "Password" | translate }}
                    </div>
                    <input class="text-right" type="password" placeholder="{{ 'Password' | translate }}" ng-model="customer.password" ng-disabled="!customer.change_password && is_logged_in" />
                </label>

                <ion-checkbox class="checkbox-custom" ng-model="customer.show_in_social_gaming" ng-if="optional_fields.ranking">
                    {{ "Show me in ranking" | translate }}
                </ion-checkbox>

                <div class="item item-custom item-icon-left" ng-click="displayPrivacyPolicy('account')" ng-if="!is_logged_in">
                    <i class="icon ion-navicon"></i>
                    {{ "Privacy Policy" | translate }}
                </div>

                <ion-checkbox class="checkbox-custom item-custom" ng-model="customer.privacy_policy" ng-if="!is_logged_in">
                    {{ "I accept the privacy policy" | translate }}
                </ion-checkbox>

                <section ng-repeat="cfo in custom_fields track by cf.code">
                    <div class="item item-divider">
                        <p>{{ cfo.name }}:</p>
                    </div>

                    <label ng-repeat="cf in cfo.custom_fields" class="item item-input item-custom">
                        <div class="input-label">
                            {{ cf.label | translate }}
                        </div>
                        <input class="text-right" type="{{cf.type}}" placeholder="{{ cf.label | translate }}" ng-model="customer.metadatas[cfo.code][cf.key]" />
                    </label>
                </section>

            </div>

            <div ng-class="{'padding': card_design}">
                <button type="submit" class="button button-positive button-positive-custom" ng-class="{'button-block': card_design, 'button-full': !card_design}" ng-show="!is_loading">{{ "Send" | translate }}</button>
            </div>

            <div class="list" ng-class="{'card': card_design}">

                <div class="item item-custom item-icon-left" ng-click="displayLoginForm()" ng-if="!is_logged_in">
                    <i class="icon ion-ios-person"></i>
                    {{ "Click here to log-in" | translate }}
                </div>

            </div>

            <section class="avatar text-center" ng-if="customer.metadatas.fidelity_points" ng-show="customer.metadatas.fidelity_points.points > 0">
                <label class="item item-custom">
                    <i class="ion-ios-information-outline"></i><strong> {{ "Your points" | translate }}</strong>
                </label>

                <div class="item item-custom">
                    {{ customer.metadatas.fidelity_points.points }}
                </div>
                <br />
            </section>

            <section class="avatar text-center" ng-if="show_avatar" ng-show="customer.stripe">
                <label class="item item-custom">
                    <i class="ion-ios-information-outline"></i><strong> {{ "Stored card information." | translate }}</strong>
                </label>

                <!-- SHOW CARD -->
                <div ng-show="customer.stripe.brand" class="item item-custom">
                    {{ "XXXX XXXX XXXX" }} {{ customer.stripe.last4 }}
                    <br />
                    {{ "CVC ***" }} - {{ "EXP" }} {{ customer.stripe.exp_month }}/{{ customer.stripe.exp_year }}
                </div>
                <button ng-show="customer.stripe.brand" type="button" class="button button-block button-custom activated" ng-click="unloadcard()">{{ "Remove card" | translate }}</button>

                <!-- ADD CARD -->
                <label ng-show="!customer.stripe.brand" class="item item-text-wrap item-custom">
                    {{ "You have no card stored. To add a card make an order." | translate }}
                </label>
            </section>

        </form>

        <div class="list" ng-class="{'card': card_design}" ng-show="display_privacy_policy">

            <div class="item item-custom item-icon-left" ng-click="displayLoginForm()" ng-if="displayed_from == 'login'">
                <i class="icon ion-ios-person"></i>
                {{ "Click here to log-in" | translate }}
            </div>

            <div class="item item-custom item-icon-left" ng-click="displayAccountForm()" ng-if="displayed_from == 'account'">
                <i class="icon ion-ios-plus-empty"></i>
                {{ "Create an account" | translate }}
            </div>

            <div ng-include="'templates/cms/privacypolicy/l1/view.html'"></div>

            <div class="item item-custom item-icon-left" ng-click="scrollTop();displayLoginForm()" ng-if="displayed_from == 'login'">
                <i class="icon ion-ios-person"></i>
                {{ "Click here to log-in" | translate }}
            </div>

            <div class="item item-custom item-icon-left" ng-click="scrollTop();displayAccountForm()" ng-if="displayed_from == 'account'">
                <i class="icon ion-ios-plus-empty"></i>
                {{ "Create an account" | translate }}
            </div>

        </div>

    </ion-content>
</ion-modal-view>
