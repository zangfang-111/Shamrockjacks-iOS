angular.module("starter").controller("TwitterListController",function($scope,$stateParams,$window,$translate,Twitter,Dialog){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,done:!1,collection:[],card_design:!1}),Twitter.setValueId($stateParams.value_id),Twitter.last_id=null,Twitter.getInfo().then(function(response){$scope.name=response[0].name,$scope.description=response[0].description,$scope.banner_url=response[0].profile_banner_url,$scope.nb_followers=response[0].followers_count,$scope.nb_friends=response[0].friends_count}),$scope.getTweets=function(){Twitter.loadData().then(function(response){$scope.collection=$scope.collection.concat(response),response.length||($scope.done=!0),Twitter.last_id=$scope.collection[$scope.collection.length-1].id},function(data){data&&angular.isDefined(data.message)&&Dialog.alert($translate.instant("Error"),data.message,$translate.instant("OK"),-1),$scope.done=!0}).then(function(){$scope.$broadcast("scroll.infiniteScrollComplete"),$scope.is_loading=!1})},$scope.loadMore=function(){$scope.done||$scope.getTweets()},$scope.removeScrollEvent=function(){angular.element($window).unbind("scroll")},$scope.getTweets()}),angular.module("starter").factory("Twitter",function($pwaRequest){var factory={value_id:null,last_id:null,extendedOptions:{}};return factory.setValueId=function(value_id){factory.value_id=value_id},factory.setExtendedOptions=function(options){factory.extendedOptions=options},factory.preFetch=function(page){factory.loadData()},factory.loadData=function(){if(!this.value_id)return $pwaRequest.reject("[Factory::Twitter.loadData] missing value_id");var data={value_id:this.value_id};return this.last_id&&(data.last_id=this.last_id),$pwaRequest.get("twitter/mobile_twitter/list",angular.extend({urlParams:data,withCredentials:!1},factory.extendedOptions))},factory.getInfo=function(){return this.value_id?$pwaRequest.get("twitter/mobile_twitter/info",{urlParams:{value_id:this.value_id},withCredentials:!1}):$pwaRequest.reject("[Factory::Twitter.getInfo] missing value_id")},factory});