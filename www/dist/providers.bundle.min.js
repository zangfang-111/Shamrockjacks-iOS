angular.module("starter").provider("HomepageLayout",function(){var self=this;self.layout_ids={},self.getLayoutIdForValueId=function(valueId){var layoutId=1;try{for(var i in self.pages)self.pages[i].value_id==valueId&&(layoutId=self.pages[i].layout_id)}catch(e){layoutId=1}return layoutId},self.setLayoutIdForValueId=function(value_id,layout_id){self.layout_ids[value_id]=layout_id;for(var i in self.pages)self.pages[i].value_id==value_id&&(self.pages[i].layout_id=layout_id)},self.$get=function($injector,$ionicSlideBoxDelegate,$ionicPlatform,$ionicHistory,$ionicSideMenuDelegate,$location,$log,$q,$rootScope,$stateParams,$timeout,$window,LinkService,Analytics,Customer,Pages,Padlock,Modal){var HomepageLayout={};return HomepageLayout.load_hooks=[],HomepageLayout.more_modal=null,HomepageLayout.openFeature=function(feature,scope){void 0===scope&&(scope=$rootScope),HomepageLayout.more_modal&&(HomepageLayout.more_modal.hide(),scope.tabbar_is_visible=!0,scope.pages_list_is_visible=!1),Modal.is_open&&Modal.current_modal.hide();var doClearHistory=!1;switch(Pages.data.layout.position){case"left":case"right":$ionicSideMenuDelegate.isOpenLeft()&&$ionicSideMenuDelegate.toggleLeft(),$ionicSideMenuDelegate.isOpenRight()&&$ionicSideMenuDelegate.toggleRight();var isPadlock="padlock"===feature.code,isSubFolder=void 0!==feature.is_subfolder&&feature.is_subfolder,hasParentFolder=void 0!==feature.has_parent_folder&&feature.has_parent_folder;isPadlock||isSubFolder||hasParentFolder||feature.path===$location.path()||(doClearHistory=!0)}switch(!0){case"tabbar_account"===feature.code:Analytics.storePageOpening({id:0}),Customer.loginModal(scope);break;case"tabbar_more"===feature.code:HomepageLayout.getFeatures().then(function(features){scope.tabbar_is_visible=!1,scope.pages_list_is_visible=!0,scope.features=features,scope.closeMore=function(){HomepageLayout.more_modal.hide(),scope.tabbar_is_visible=!0,scope.pages_list_is_visible=!1},scope.goTo=function(goToFeature){HomepageLayout.openFeature(goToFeature,scope)},Modal.fromTemplateUrl(HomepageLayout.getModalTemplate(),{scope:scope}).then(function(modal){HomepageLayout.more_modal=modal,HomepageLayout.more_modal.show(),$ionicPlatform.onHardwareBackButton(function(e){scope.pages_list_is_visible&&scope.closeMore()})})});break;case $rootScope.isOffline&&!feature.offline_mode&&$rootScope.isNotAvailableOffline():break;case feature.is_link:LinkService.openLink(feature.url,{hide_navbar:!!feature.hide_navbar,use_external_app:!!feature.use_external_app}),Analytics.storePageOpening(feature);break;default:Analytics.storePageOpening(feature),!$injector.get("Application").is_customizing_colors&&HomepageLayout.properties.options.autoSelectFirst?feature.path!==$location.path()&&(doClearHistory&&$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1}),$location.path(feature.path).replace()):$location.path(feature.path)}},HomepageLayout.registerHook=function(hook){"function"==typeof hook&&HomepageLayout.load_hooks.push(hook)},HomepageLayout.callHooks=function(){for(var i=0;i<HomepageLayout.load_hooks.length;i++)HomepageLayout.load_hooks[i]();$timeout(function(){$ionicSlideBoxDelegate.update()},800)},HomepageLayout.getTemplate=function(){var layout_code=HomepageLayout.properties.layoutCode,layout_id=HomepageLayout.properties.layoutId;return $injector.has(layout_code)?$injector.get(layout_code).getTemplate():"templates/home/"+layout_id+"/view.html"},HomepageLayout.getModalTemplate=function(){var layout_code=HomepageLayout.properties.layoutCode;return $injector.has(layout_code)?$injector.get(layout_code).getModalTemplate():"templates/home/modal/view.html"},HomepageLayout._initData=function(){HomepageLayout.data=null,HomepageLayout.need_to_build_the_options=!0,HomepageLayout.options=null,HomepageLayout.is_initialized=!1,HomepageLayout.dataLoading=!1,HomepageLayout.properties={options:{autoSelectFirst:!1,isRootPage:!1,current:null},menu:{position:"normal",visibility:"homepage",isVisible:!1,sidebarLeftWidth:"120",sidebarRightWidth:"120"}}},HomepageLayout.getData=function(){var deferred=$q.defer();return null===HomepageLayout.data?HomepageLayout.dataLoading?$timeout(function(){deferred.resolve(HomepageLayout.getData())}):Pages.ready.then(function(){if(HomepageLayout.dataLoading=!0,HomepageLayout.data=Pages.data,self.pages=Pages.data.pages,self.layout_ids=Pages.data.layouts,HomepageLayout.properties.layoutId=Pages.data.layout_id,HomepageLayout.properties.layoutCode=Pages.data.layout_code,HomepageLayout.properties.layoutOptions=Pages.data.layout.layout_options,HomepageLayout.properties.tabbar_is_transparent=Pages.data.tabbar_is_transparent,void 0!==HomepageLayout.properties.layoutOptions&&void 0!==HomepageLayout.properties.layoutOptions.sidebarWidth)switch(HomepageLayout.properties.layoutOptions.sidebarWidthUnit){case"pixel":HomepageLayout.properties.menu.sidebarLeftWidth=HomepageLayout.properties.layoutOptions.sidebarWidthPixel;break;case"percentage":var width=$window.innerWidth;HomepageLayout.properties.menu.sidebarLeftWidth=width/100*HomepageLayout.properties.layoutOptions.sidebarWidth}HomepageLayout._init(),HomepageLayout.dataLoading=!1,deferred.resolve(HomepageLayout.data)}):(HomepageLayout.need_to_build_the_options&&HomepageLayout._buildOptions(),deferred.resolve(HomepageLayout.data)),deferred.promise},HomepageLayout.getOptions=function(){var deferred=$q.defer();return null===HomepageLayout.options?HomepageLayout.getData().then(function(data){deferred.resolve(HomepageLayout.options)},function(err){deferred.reject(err)}):deferred.resolve(HomepageLayout.options),deferred.promise},HomepageLayout.getActiveOptions=function(){var deferred=$q.defer();return HomepageLayout.getOptions().then(function(options){options=options.reduce(function(options,option){return option.is_active&&options.push(option),options},[]),HomepageLayout.data.customer_account.url=Customer.isLoggedIn()?HomepageLayout.data.customer_account.edit_url:HomepageLayout.data.customer_account.login_url,HomepageLayout.data.customer_account.path=Customer.isLoggedIn()?HomepageLayout.data.customer_account.edit_path:HomepageLayout.data.customer_account.login_path,HomepageLayout.data.customer_account.is_visible&&options.push(HomepageLayout.data.customer_account),deferred.resolve(options)}),deferred.promise},HomepageLayout.getFeatures=function(){var deferred=$q.defer();return HomepageLayout.getActiveOptions().then(function(options){var features={layoutId:HomepageLayout.data.layout_id,layoutCode:HomepageLayout.data.layout_code,layoutOptions:HomepageLayout.data.layout.layout_options,options:options,overview:{hasMore:!1,options:[],paged_options:[],limit:HomepageLayout.data.limit_to},data:HomepageLayout.data},limit=features.overview.limit;if(null!==limit&&limit>0&&features.options.length>limit)if(HomepageLayout.data.layout.use_horizontal_scroll){for(var paged_options=[],i=0;i<features.options.length;i++)paged_options.push(features.options[i]),(i+1)%limit==0&&(features.overview.paged_options.push(paged_options),paged_options=[]);paged_options.length&&features.overview.paged_options.push(paged_options)}else{for(i=0;i<limit-1;i++)features.overview.options.push(features.options[i]);features.overview.hasMore=!0}else HomepageLayout.data.layout.use_horizontal_scroll?features.overview.paged_options=[features.options]:features.overview.options=features.options;var more_button={name:features.data.more_items.name,icon_url:features.data.more_items.icon_url,icon_is_colorable:features.data.more_items.icon_is_colorable,code:features.data.more_items.code,url:"tabbar_more"},layout_code=HomepageLayout.data.layout_code;$injector.has(layout_code)?(features=$injector.get(layout_code).features(features,more_button),HomepageLayout.registerHook(function(){$injector.get(layout_code).onResize()}),window.addEventListener("orientationchange",function(){$injector.get(layout_code).onResize()})):features.overview.hasMore&&features.overview.options.push(more_button),$timeout(function(){$ionicSlideBoxDelegate.update()},200),features.first_option=!1,HomepageLayout.properties.options.autoSelectFirst&&0!==features.options.length&&(features.first_option=features.options[0]),deferred.resolve(features)}),deferred.promise},HomepageLayout._updateFromUrl=function(url){if(null!==HomepageLayout.options){if($stateParams.value_id){var optionId=parseInt($stateParams.value_id),currentOption=HomepageLayout.options.reduce(function(currentOption,option){return option.id===optionId&&(option.url===url?(HomepageLayout.properties.options.isRootPage=!0,HomepageLayout.properties.menu.isVisible="always"===HomepageLayout.properties.menu.visibility):(HomepageLayout.properties.options.isRootPage=!1,HomepageLayout.properties.menu.isVisible="always"===HomepageLayout.properties.menu.visibility||!1),currentOption=option),currentOption},null);return null===currentOption?HomepageLayout.properties.options.isRootPage=!1:HomepageLayout.properties.options.current!==currentOption&&(HomepageLayout.properties.options.current=currentOption),currentOption}if(!/customer\/mobile_account/.test(url)&&!/cms\/mobile_privacypolicy/.test(url))return null;HomepageLayout.properties.options.isRootPage=/customer\/mobile_account_login/.test(url),HomepageLayout.properties.menu.isVisible="always"===HomepageLayout.properties.menu.visibility,HomepageLayout.properties.options.current=null}},HomepageLayout.fireLocationChanged=function(){HomepageLayout._updateFromUrl($location.absUrl())},HomepageLayout._init=function(){HomepageLayout._buildOptions();HomepageLayout.properties.menu.position=HomepageLayout.data.layout.position,HomepageLayout.properties.menu.visibility=HomepageLayout.data.layout.visibility,HomepageLayout.properties.options.autoSelectFirst="homepage"!==HomepageLayout.properties.menu.visibility,HomepageLayout._updateFromUrl($location.absUrl()),HomepageLayout.is_initialized=!0},HomepageLayout.setLayoutId=function(value_id,layout_id){self.setLayoutIdForValueId(value_id,layout_id)},HomepageLayout._buildOptions=function(){return HomepageLayout.options=HomepageLayout.data.pages.reduce(function(options,option){return(!option.is_locked||Customer.can_access_locked_features||Padlock.unlocked_by_qrcode)&&((Customer.isLoggedIn()||Padlock.unlocked_by_qrcode)&&"padlock"===option.code||options.push(option)),options},[]),HomepageLayout.need_to_build_the_options=!1,HomepageLayout.options},HomepageLayout._initData(),{leftAreaSize:150,openFeature:function(feature,scope){return HomepageLayout.openFeature(feature,scope)},registerHook:function(hook){return HomepageLayout.registerHook(hook)},callHooks:function(){return HomepageLayout.callHooks()},getTemplate:function(){return HomepageLayout.getTemplate()},getModalTemplate:function(){return HomepageLayout.getModalTemplate()},getData:function(){return HomepageLayout.getData()},unsetData:function(){HomepageLayout._initData(),$rootScope.$broadcast("tabbarStatesChanged")},getOptions:function(){return HomepageLayout.getOptions()},getActiveOptions:function(){return HomepageLayout.getActiveOptions()},getFeatures:function(){return HomepageLayout.getFeatures()},isInitialized:function(){return HomepageLayout.is_initialized},unlockByQRCode:function(qrcode){return HomepageLayout.unlockByQRCode(qrcode)},setNeedToBuildTheOptions:function(need_to_build_the_options){HomepageLayout.options=null,HomepageLayout.need_to_build_the_options=need_to_build_the_options},rebuildOptions:function(){HomepageLayout._buildOptions()},setLayoutId:function(value_id,layout_id){HomepageLayout.setLayoutId(value_id,layout_id)},properties:HomepageLayout.properties,app:{fireLocationChanged:HomepageLayout.fireLocationChanged}}}}),angular.module("starter").provider("$pwaCache",function(){this.$get=function(){var provider={};return void 0===window.localforage?provider={isEnabled:!1}:(provider={isEnabled:!0,defaultDrivers:[window.localforage.INDEXEDDB,window.localforage.LOCALSTORAGE],defaultStoreName:"content-cache",valueidStoreName:"valueid-index",registryStoreName:"registry-index",cacheKey:"pwa-cache-"+APP_KEY,cacheMaxSize:64e6,defaultCache:null,valueidCache:null,registryCache:null,backgroundImages:[]},provider.defaultCache=window.localforage.createInstance({driver:provider.defaultDrivers,name:provider.cacheKey,storeName:provider.defaultStoreName,size:provider.cacheMaxSize}),provider.valueidCache=window.localforage.createInstance({driver:provider.defaultDrivers,name:provider.cacheKey,storeName:provider.valueidStoreName,size:provider.cacheMaxSize/16}),provider.registryCache=window.localforage.createInstance({driver:window.localforage.LOCALSTORAGE,name:provider.cacheKey,storeName:provider.registryStoreName,size:provider.cacheMaxSize/16}),provider.getDefaultCache=function(){return provider.defaultCache},provider.getValueidCache=function(){return provider.valueidCache},provider.getRegistryCache=function(){return provider.registryCache},provider)}}),angular.module("starter").factory("FallbackPromise",function($q){return{resolved:!1,decorate:function(promise){promise.success=function(callback){return promise.then(callback),promise},promise.error=function(callback){return promise.then(null,callback),promise}},defer:function(){var deferred=$q.defer();return this.decorate(deferred.promise),deferred}}}),angular.module("starter").provider("$pwaRequest",function(){var provider={debug:!0,queue:null,defaultCache:null,valueidCache:null,registryCache:null,cacheIsEnabled:!1};return provider.$get=["$pwaCache","$injector","$rootScope","$session","$translate","$http","$log","$q","$queue","FallbackPromise","Url",function($pwaCache,$injector,$rootScope,$session,$translate,$http,$log,$q,$queue,FallbackPromise,Url){provider.cacheIsEnabled=$pwaCache.isEnabled,provider.defaultCache=$pwaCache.getDefaultCache(),provider.valueidCache=$pwaCache.getValueidCache(),provider.registryCache=$pwaCache.getRegistryCache();var httpCacheLayerConfig={debug:provider.debug};return provider.handleRequest=function(options){options=angular.extend({},options,{cache:!1}),$http(options).then(function(response){options.first_cache?$log.debug("caching: response success",response,cachedResponse):$log.debug("caching again: response success",response,cachedResponse);var cachedResponse={expires_at:options.expires_at,touched_at:options.touched_at,data:angular.copy(response.data)};provider.defaultCache.setItem(options.cacheKey,cachedResponse),options.network_promise.resolve(angular.copy(response.data)),(options.return_response||options.pullToRefresh)&&options.deferred_promise.resolve(angular.copy(response.data))},function(response){$log.debug("response error",response);var data={error:!0,message:$translate.instant("The request returned a 400 HTTP Code, with no message.")};_.isObject(response)&&_.isObject(response.data)&&(data=response.data),_.isObject(response)&&410===response.status&&($log.debug("remove gone resource"),provider.defaultCache.removeItem(options.cacheKey)),options.network_promise.reject(data),options.return_response&&options.deferred_promise.reject(data),options.pullToRefresh&&(data.message=$translate.instant("Unable to refresh content, please try again later."),options.deferred_promise.reject(data))}).catch(function(errrrrr){$log.error("Catched error: "+errrrrr)})},null===provider.queue&&(provider.queue=$queue.queue(provider.handleRequest,{delay:100,paused:!1,persistent:!0,max_concurrent:5}),provider.queue.start()),new function(httpCacheLayerConfig){var httpWrapper=function(requestOptions){var current=Math.trunc((new Date).getTime()/1e3),options=_.extend(requestOptions,{method:_.upperCase(_.trim(_.get(requestOptions,"method","GET"))),cache:!!_.get(requestOptions,"cache",!0),url:_.trim(_.get(requestOptions,"url")),pullToRefresh:!!_.get(requestOptions,"refresh",!1),imageProxy:!!_.get(requestOptions,"imageProxy",!1),requestData:_.get(requestOptions,"data",{}),expires_at:_.get(requestOptions,"expires_at",current+3600),touched_at:_.get(requestOptions,"touched_at",current),network_promise:_.get(requestOptions,"network_promise",$q.defer()),timeout:_.get(requestOptions,"timeout",3e4),deferred_promise:FallbackPromise.defer()});if(options.deferred_promise.promise.__name__="pwa-"+Math.random(),!provider.cacheIsEnabled||!options.cache){if($rootScope.isOnline)$log.debug("direct request, no cache.",options.url),$http(requestOptions).then(function(response){options.deferred_promise.resolve(response.data)},function(response){if(response&&response.data)void 0===response.data.message&&(response.data.message=$translate.instant("An unknown error occurred.")),options.deferred_promise.reject(response.data);else{var error={error:!0,message:$translate.instant("The resource is not reachable, check your network connection.")};options.deferred_promise.reject(error)}}).catch(function(err){var error={error:!0,message:$translate.instant("[Network] The resource is not reachable, check your network connection.")};options.deferred_promise.reject(error)});else{var error={error:!0,message:$translate.instant("[Network] Device is offline, aborting request.")};options.deferred_promise.reject(error)}return console.log("deferred",options.deferred_promise),options.deferred_promise.promise}var cacheKey=options.url;if(options.imageProxy&&void 0===(cacheKey=options.requestData.resource))return $q.reject({error:!0,message:$translate.instant("Resource is `undefined`.")});var value_id=_.get(options.urlParams,"value_id",!1),valueidCachekey="valueid_"+value_id;!1!==value_id&&provider.valueidCache.getItem(valueidCachekey).then(function(cached_array){var copy=angular.copy(cached_array);null===copy?provider.valueidCache.setItem(valueidCachekey,[cacheKey]):options.pullToRefresh?(options.timeout=6e4,angular.forEach(copy,function(uri){provider.defaultCache.removeItem(uri)}),provider.valueidCache.setItem(valueidCachekey,[cacheKey])):-1===copy.indexOf(cacheKey)&&(copy.push(cacheKey),provider.valueidCache.setItem(valueidCachekey,copy))});var touched=$injector.get("Pages").getForValueId(value_id),data_break=null;return-1!==touched.touched_at&&(options=angular.extend({},options,{touched_at:touched.touched_at,expires_at:touched.expires_at})),options=angular.extend({},options,{cacheKey:cacheKey}),provider.defaultCache.getItem(cacheKey).then(function(cached_object){if(null===cached_object)$log.debug("network: ",cacheKey),options.return_response=!0,options.first_cache=!0,provider.queue.addFirst(options);else{data_break=angular.copy(cached_object),options.first_cache=!1;var will_refresh=!1;if(options.imageProxy)return angular.extend(cached_object,{expires_at:options.expires_at,touched_at:options.touched_at}),provider.defaultCache.setItem(cacheKey,cached_object),options.network_promise.resolve(data_break.data),void options.deferred_promise.resolve(data_break.data);if(-1===cached_object.expires_at)options.touched_at>cached_object.touched_at?($log.debug("content is newer, we will refresh it.",options.touched_at," > ",cached_object.touched_at,cacheKey),will_refresh=!0):($log.debug("content will not be refreshed, already up-to-date.",cached_object),will_refresh=!0);else{var current_time=Math.trunc((new Date).getTime()/1e3);cached_object.expires_at<current_time?($log.debug("cache expired, renewing ",cached_object.expires_at," < ",current_time,cacheKey),will_refresh=!0):($log.debug("cache is not expired, won't refresh.",cached_object),will_refresh=!0)}(will_refresh||options.pullToRefresh)&&(options.pullToRefresh?(options.timeout=6e4,provider.queue.globalPause(),options.return_response=!0,provider.handleRequest(options),options.deferred_promise.promise.then(function(){provider.queue.globalStart()})):(options.return_response=!1,provider.queue.add(options))),options.pullToRefresh||options.deferred_promise.resolve(data_break.data)}}).catch(function(error){options.deferred_promise.reject({error:!0,message:$translate.instant("The given resource is not reachable")+" "+cacheKey,exception:error})}),console.log("options.deferred_promise",options.deferred_promise),options.deferred_promise.promise};return httpWrapper.get=function(url,config){return 0!==url.indexOf("http")&&(url=Url.get(url,_.get(config,"urlParams",{}))),$rootScope.isOffline&&(void 0===config?config={refresh:!1}:config.refresh=!1),httpWrapper(_.extend({method:"GET",url:url,cache:!$rootScope.isOverview,responseType:"json"},config||{}))},httpWrapper.post=function(url,config){return 0!==url.indexOf("http")&&(url=Url.get(url,_.get(config,"urlParams",{}))),$rootScope.isOffline&&(void 0===config?config={refresh:!1}:config.refresh=!1),httpWrapper(_.extend({method:"POST",url:url,cache:!$rootScope.isOverview,responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"}},config||{}))},httpWrapper.head=$http.head,httpWrapper.put=$http.put,httpWrapper.delete=$http.delete,httpWrapper.jsonp=$http.jsonp,httpWrapper.patch=$http.patch,Object.defineProperty(httpWrapper,"postForm",{get:function(){return $http.postForm}}),httpWrapper.cache=function(uri,config){return httpWrapper.get(uri,{cache:!$rootScope.isOverview})},httpWrapper.cacheImage=function(uri){return isNativeApp&&window.OfflineMode?$q(function(resolve,reject){window.OfflineMode.cacheURL(uri,function(){$log.info("cached URL succesfully : ",uri),resolve()},function(){$log.info("Failed to cache URL : ",uri),reject()})}):$q.reject()},httpWrapper.getItem=function(key,dataCallback){if("function"!=typeof dataCallback)throw new Error("dataCallback must be a function.");var deferred=$q.defer();return provider.registryCache.getItem(key).then(function(cachedData){null===cachedData?provider.registryCache.setItem(key,dataCallback.call(this)).then(function(resolve){deferred.resolve(resolve)},function(reject){deferred.reject(reject)}):(provider.registryCache.setItem(key,dataCallback.call(this)),deferred.resolve(cachedData))}).catch(function(error){deferred.reject(null)}),deferred.promise},httpWrapper.reject=function(message){return message=void 0!==message?message:$translate.instant("The request is probably missing some parameters."),$q.reject({error:!0,message:message})},httpWrapper.resolve=function(data){return $q.resolve(data)},httpWrapper.defer=function(){return $q.defer()},httpWrapper.getPayloadForValueId=function(value_id){return $injector.get("Pages").getPayloadForValueId(value_id)},httpWrapper.clearValueId=function(value_id){var deferred=$q.defer();return provider.valueidCache.getItem("valueid_"+value_id).then(function(cached_uris){var copy=angular.copy(cached_uris);null!==copy&&angular.forEach(copy,function(uri){provider.defaultCache.removeItem(uri)}),provider.valueidCache.removeItem("valueid_"+value_id).then(function(){deferred.resolve()})}).catch(function(){deferred.resolve()}),deferred.promise},httpWrapper.removeCached=function(uri){return $pwaCache.getDefaultCache().removeItem(uri)},httpWrapper}(httpCacheLayerConfig)}],provider}),angular.module("starter").provider("$sbhttp",function(){var b={alwaysCache:!1,neverCache:!1,debug:!1};return b.$get=["$rootScope","$http","$log","$q","$window","_",function(c,d,e,f,g,h){var j,i={alwaysCache:b.alwaysCache,neverCache:!b.alwaysCache&&b.neverCache,debug:!0===b.debug};return j={},j.getItem=j.setItem=j.removeItem=function(){return f.reject("no offline mode cache in webview")},(ionic.Platform.isIOS()||ionic.Platform.isAndroid())&&window.localforage&&(window.localforage.config({name:"sb-offline-mode",storeName:"keyvaluepairs",size:262144e3}),j=window.localforage),new function(a){var b=function(b){var g=h.upperCase(h.trim(h.get(b,"method"))),i=h.trim(h.get(b,"url"));if(e.debug(new Error("Stacktrace following").stack),"GET"===g&&i.length>0){e.debug("GET "+i);var k=c.isOnline,l=!a.neverCache||a.alwaysCache,m=h.get(b,"cache",l),n=[angular.noop],o=[angular.noop],p=!1,q=!1,r=f(function(a,c){var f=function(f){try{for(;h.isString(f)&&h.trim(f).length>0;)f=JSON.parse(f)}catch(a){e.info("Error parsing data :",a,data),f=null}var g=m&&f,l=h.extend({},b,{}),r=function(b){if(e.debug("Processing http response ("+i+") with status code "+h.get(b,"status")),h.isObject(b)&&0===b.status&&h.isObject(g))return k=!1,e.debug("request failed for "+i+": using cache"),r(g);p=!0;var d=(q=!((g=b).status>=200&&g.status<=299))?o:n,f=q?c:a,s=function(){h.isFunction(g.headers)&&"true"===g.headers("X-From-Native-Cache")&&(g=h.extend({},g,{fromCache:!0})),h.forEach(d,function(a){a(g.data,g.status,g.headers,l)}),f(g)};if(h.isObject(g)&&(k||!0!==g.fromCache)&&m&&!q){e.debug("caching response for URL "+i+" and status "+h.get(b,"status"));var t=JSON.stringify(h.extend({},g,{fromCache:!0}));try{t=JSON.stringify(t)}catch(a){e.info("Error stringifying data :",a,t)}return j.setItem(i,t).then(s,function(a){e.debug("LOCAL FORAGE ERROR : ",a),s()})}return s()};h.isObject(g)&&!k?(e.debug("we're offline: using cache"),r(g)):(e.debug("sending http call with config: ",l),d(l).then(r,r))};j.getItem(i).then(f,function(a){return e.debug("Error retrieving data from cache data :",a),f(null)})});return r.success=function(a){return h.isFunction(a)&&n.push(a),p&&!q&&a(response.data,response.status,response.headers,config),r},r.error=function(a){return h.isFunction(a)&&o.push(a),p&&q&&a(response.data,response.status,response.headers,config),r},r}return d(b)};return b.get=function(a,c){return b(h.extend({},c||{},{method:"GET",url:a}))},b.head=d.head,b.post=d.post,b.put=d.put,b.delete=d.delete,b.jsonp=d.jsonp,b.patch=d.patch,Object.defineProperty(b,"postForm",{get:function(){return d.postForm}}),b.cache=function(a){return!c.is_webview&&window.OfflineMode?f(function(b,c){window.OfflineMode.cacheURL(a,function(){e.info("cached URL succesfully : ",a),b()},function(){e.info("Failed to cache URL : ",a),c()})}):f.reject()},b.removeCached=function(a){return j.removeItem(a)},b}(i)}],b}),angular.module("starter").service("httpCache",function($sbhttp,$cacheFactory,ConnectionService){return{remove:function(url){var sid=localStorage.getItem("sb-auth-token");return sid&&-1==url.indexOf(".html")&&ConnectionService.isOnline&&(url=url+"?sb-token="+sid),angular.isDefined($cacheFactory.get("$http").get(url))&&$cacheFactory.get("$http").remove(url),$sbhttp.removeCached(url),this}}});